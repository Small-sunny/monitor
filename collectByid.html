<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords" content="admin, dashboard, bootstrap, template, flat, modern, theme, responsive, fluid, retina, backend, html5, css, css3">
    <meta name="description" content="">
    <meta name="author" content="ThemeBucket">
    <link rel="shortcut icon" href="#" type="image/png">

    <title>我的采集项</title>

    <!--icheck-->
    <link href="js/iCheck/skins/minimal/minimal.css" rel="stylesheet">
    <link href="js/iCheck/skins/square/square.css" rel="stylesheet">
    <link href="js/iCheck/skins/square/red.css" rel="stylesheet">
    <link href="js/iCheck/skins/square/blue.css" rel="stylesheet">

    <!--dashboard calendar-->
    <link href="css/clndr.css" rel="stylesheet">

    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="js/morris-chart/morris.css">

    <!--common-->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style1.css">
    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
    <style>
        .header-section{
            background-color: #65CEA7;
        }
        .wrapper .panel-heading{
            background-color: #65CEA7;
            color:#fff;
        }
        hr{
            margin: 0;
        }
        #address{
            min-width:200px;
            border:1px solid #eee;
            border-radius: 5px;
            padding:5px;
        }
        #clist tbody td{
            max-width:400px;
            height:auto;
            text-wrap: normal;
        }

        #myModal .modal-content{
            margin-top: 70px;
        }
        #collectConfig{

        }
        /*details*/
        .details{
            width: 600px;
            padding: 10px;
            margin: 0 auto;
        }
        .details li{
            line-height:24px;
        }
        .details li>label{
            text-align: justify;
        }

        #myModal .modal-content{
            margin-top: 200px;
        }
        .c-content .col-lg-6{
            padding: 0;
        }
        .list-group-item{
            padding: 5px;
        }
        .back-btn{
            margin-bottom: 10px;
        }
/**/
    </style>

</head>

<body class="sticky-header">

<section>
    <!-- left side start-->
    <div class="left-side sticky-left-side">

        <!--logo and iconic logo start-->
        <div class="logo">
            <h4><a href="index.html"><span>Lumino</span>Admin</a></h4>
        </div>

        <!--<div class="logo-icon text-center">
            <a href="index.html"><img src="images/logo_icon.png" alt=""></a>
        </div>-->
        <!--logo and iconic logo end-->
        <div class="left-side-inner">
            <ul class="nav nav-pills nav-stacked custom-nav">
                <li class="menu-list">
                    <a href=""><i class="fa fa-laptop"></i> <span>告警信息管理</span></a>
                    <ul class="sub-menu-list">
                        <li ><a onclick="indexlists();">告警信息列表</a></li>
                    </ul>
                </li>
                <li class="menu-list active">
                    <a><i class="fa fa-book"></i> <span>我的监控项</span></a>
                    <ul class="sub-menu-list">
                        <li class="active"><a onclick="myalarm();">所有客户端列表</a></li>
                    </ul>
                </li>
                <li class="menu-list">
                    <a onclick="collect();"><i class="fa fa-dashboard"></i> <span>采集项配置</span></a>
                </li>
            </ul>
            <!--sidebar nav end-->
        </div>
    </div>
    <!-- left side end-->

    <!-- main content start-->
    <div class="main-content" >

        <!-- header section start-->
        <div class="header-section">

            <!--toggle button start-->
            <a class="toggle-btn"><i class="fa fa-bars"></i></a>
            <!--toggle button end-->

            <!--search start-->
            <form class="searchform" action="index.html" method="post">
                <input type="text" class="form-control" name="keyword" placeholder="Search here..." />
            </form>
            <!--search end-->

            <!--notification menu start  右侧登录信息-->
            <div class="menu-right">
                <ul class="notification-menu">
                    <li>
                        <a  href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                            <img src="images/photos/user-avatar.png" alt="" />
                            <span id="uname">登录</span>
                            <span class="caret"></span>
                        </a>
                        <ul id="user" class="dropdown-menu dropdown-menu-usermenu pull-right">
                            <li><a href="#" disabled="true"><i class="fa fa-user"></i>修改密码</a></li>
                            <!--<li><a href="#"><i class="fa fa-cog"></i>  Settings</a></li>-->
                            <li><a disabled="true" onclick="loginOut();"><i class="fa fa-sign-out"></i>退出</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!--notification menu end -->

        </div>
        <!-- header section end-->

        <!-- page heading start-->
        <div class="page-heading">
            <h1>我的采集项</h1>
        </div>
        <!-- page heading end-->
        <hr/>

        <!--body wrapper start-->
        <div class="wrapper">
            <div class="row">
                <div class="col-xs-12 col-md-12">
                    <div class="panel ">
                        <div class="panel-heading panel-blue">详细信息</div>
                        <div class="panel-body">
                            <a onclick="myalarm();" class="back-btn btn btn-success"><span class="glyphicon glyphicon-share"></span>返回</a><br>
                            <table class="table table-striped table-hover" id="clists">

                            </table>
                            <ul id="footer" class="pagination">
                                <!--<li><a href="">首页</a></li>
                                <li class="disabled"><a href="">上一页</a></li>
                                <li class="active"><a href="">1</a></li>
                                <li class="disabled"><a href="">下一页</a></li>
                                <li><a href="">尾页</a></li>
                                <li id="count"></li>
                                -->
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <!--body wrapper end-->

    </div>
    <!-- main content end-->
</section>

<!-- Placed js at the end of the document so the pages load faster -->
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/modernizr.min.js"></script>
<script src="js/jquery.nicescroll.js"></script>


<!--easy pie chart-->
<script src="js/easypiechart/jquery.easypiechart.js"></script>
<script src="js/easypiechart/easypiechart-init.js"></script>

<!--Sparkline Chart-->
<script src="js/sparkline/jquery.sparkline.js"></script>
<script src="js/sparkline/sparkline-init.js"></script>

<!--icheck -->
<script src="js/iCheck/jquery.icheck.js"></script>
<script src="js/icheck-init.js"></script>

<!--Calendar-->
<script src="js/calendar/clndr.js"></script>
<script src="js/calendar/evnt.calendar.init.js"></script>
<script src="js/calendar/moment-2.2.1.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>

<!--common scripts for all pages-->

<script src="js/scripts.js"></script>

<script src="js/baiduTemplate.js"></script>

<script id="t:table" type="text/html">
    <@var item=data.collectionsConf.collectMonitorItems;@>
    <tbody>
    <tr>
        <th>ID</th>
        <td><@=data.id@></td>
    </tr>
    <tr>
        <th>地点</th>
        <td>
            <@=data.address@>
            &nbsp;&nbsp;&nbsp;&nbsp;
            <a data-toggle="modal" data-target="#myModal" class="btn btn-success">修改地址</a>
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-body">
                            <p><input id="address" type="text" value="<@=data.address@>"></p>
                            <p>
                                <a onclick="updateClientAddress();" class="btn btn-success">保存</a>
                                <a href="" class="btn btn-default">取消</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </td>
    </tr>
    <tr>
        <th>告警项</th>
        <td >
            <p>
                <a onclick="alarmConfig('<@=data.id@>');" class="btn btn-success">
            修改告警项</a>
            </p>

            <ul class="list-group">
                <@var mon=data.monitorItemsAlarm@>
                <@var mon1=[];@>
                <@var mon2=[];@>
                <@ for (var i = 0; i < mon.length; i++){ @>

                <@mon1.push(mon[i].split(' ')[0]);@>
                <@console.log(mon1);@>
                <li class="list-group-item">
                    <@if(mon1[i]=='use_cpu'){@>
                    cpu使用率  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='eth0_tx'){@>
                    eth0网卡出网速  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='ping_value'){@>
                    ping延时  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='mem_free'){@>
                    内存占用  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='mem_total'){@>
                    内存总大小  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='pix_percent'){@>
                    pix占比  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='pix_total'){@>
                    pix总大小  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='root_percent'){@>
                    根目录占比  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='root_total'){@>
                    根目录总大小  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='current_time'){@>
                    脚本执行时间  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='io_util'){@>
                    磁盘io使用率  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='raid_ok'){@>
                    raid卡状态  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='sys_uptime'){@>
                    系统开机时长  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='cpu_temp'){@>
                    cpu温度  (<@=mon[i]@>),
                    <@}@>
                    <@if(mon1[i]=='eth0_rx'){@>
                    eth0网卡入网速  (<@=mon[i]@>),
                    <@}@>
                </li>

                <@}@>
            </ul>
        </td>

    </tr>
    <tr>
        <th>采集项</th>
        <td>
            <a><@=data.collectionsConf.remark@></a>
            <a onclick="collectByid('<@=data.id@>');" class="btn btn-success">修改采集项</a>
            <div class="c-content">

                <div class="col-lg-6">
                <h4>已监控：</h4>
                <ul class="list-group" id="collectConfig">

                    <@ for (var i = 0; i < item.length; i++){ @>
                    <@if(item[i].indexOf("-")==-1){@>
                    <@item[i]=item[i].replace("+","");@>
                    <li class="list-group-item">
                        <@if(item[i]=='use_cpu'){@>
                        cpu使用率
                        <@}@>
                        <@if(item[i]=='eth0_tx'){@>
                        eth0网卡出网速
                        <@}@>
                        <@if(item[i]=='ping_value'){@>
                        ping延时
                        <@}@>
                        <@if(item[i]=='mem_free'){@>
                        内存占用
                        <@}@>
                        <@if(item[i]=='mem_total'){@>
                        内存总大小
                        <@}@>
                        <@if(item[i]=='pix_percent'){@>
                        pix占比
                        <@}@>
                        <@if(item[i]=='pix_total'){@>
                        pix总大小
                        <@}@>
                        <@if(item[i]=='root_percent'){@>
                        根目录占比
                        <@}@>
                        <@if(item[i]=='root_total'){@>
                        根目录总大小
                        <@}@>
                        <@if(item[i]=='current_time'){@>
                        脚本执行时间
                        <@}@>
                        <@if(item[i]=='io_util'){@>
                        磁盘io使用率
                        <@}@>
                        <@if(item[i]=='raid_ok'){@>
                        raid卡是否正常
                        <@}@>
                        <@if(item[i]=='sys_uptime'){@>
                        系统开机时长
                        <@}@>
                        <@if(item[i]=='cpu_temp'){@>
                        cpu温度
                        <@}@>
                        <@if(item[i]=='eth0_rx'){@>
                        eth0网卡入网速
                        <@}@>
                    </li>
                    <@}@>
                    <@}@>
                </ul>
                </div>

                <div class="col-lg-6">
                <h4>未监控：</h4>
                <ul class="list-group">
                    <@ for (var i = 0; i < item.length; i++){ @>
                    <@if(item[i].indexOf("-")!=-1){@>
                    <@item[i]=item[i].replace("-","");@>

                    <li class="list-group-item">
                        <@if(item[i]=='use_cpu'){@>
                        cpu使用率
                        <@}@>
                        <@if(item[i]=='eth0_tx'){@>
                        eth0网卡出网速
                        <@}@>
                        <@if(item[i]=='ping_value'){@>
                        ping延时
                        <@}@>
                        <@if(item[i]=='mem_free'){@>
                        内存占用
                        <@}@>
                        <@if(item[i]=='mem_total'){@>
                        内存总大小
                        <@}@>
                        <@if(item[i]=='pix_percent'){@>
                        pix占比
                        <@}@>
                        <@if(item[i]=='pix_total'){@>
                        pix总大小
                        <@}@>
                        <@if(item[i]=='root_percent'){@>
                        根目录占比
                        <@}@>
                        <@if(item[i]=='root_total'){@>
                        根目录总大小
                        <@}@>
                        <@if(item[i]=='current_time'){@>
                        脚本执行时间
                        <@}@>
                        <@if(item[i]=='io_util'){@>
                        磁盘io使用率
                        <@}@>
                        <@if(item[i]=='raid_ok'){@>
                        raid卡是否正常
                        <@}@>
                        <@if(item[i]=='sys_uptime'){@>
                        系统开机时长
                        <@}@>
                        <@if(item[i]=='cpu_temp'){@>
                        cpu温度
                        <@}@>
                        <@if(item[i]=='eth0_rx'){@>
                        eth0网卡入网速
                        <@}@>
                    </li>
                    <@}@>
                    <@}@>
                </ul>
                </div>
            </div>

        </td>
    </tr>


</script>
<script id="t1:table" type="text/html">

    <select id="l-sel">

        <option value="">111</option>

    </select>
</script>
<script>
    var bt=baidu.template;
    var userName;
    function getuserName(name) {
        var reg1 = new RegExp("(^|&)" + name + "=([^&]*)(&|;)", "i");
        //	    var r = window.location.search.substr(1).match(reg);
        var r1 = decodeURI(window.location.search.substr(1)).match(reg1);
        if (r1 != null) return unescape(r1[2]); return null;
    }
    userName = getuserName("userName");
    //获取cid
    var cid;
    function getCid(name) {
        var reg = new RegExp("(^|:)" + name + "=([^:]*)(:|$)", "i");
        //	    var r = window.location.search.substr(1).match(reg);
        var r = decodeURI(window.location.search.substr(1)).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }
    cid=getCid("cid");
    console.log(cid);
    var jsessionid;
    //获取jsessionid
    function getSessionid(name) {
        var reg = new RegExp("(^|;)" + name + "=([^;]*)(;|:)", "i");
        //	    var r = window.location.search.substr(1).match(reg);
        var r = decodeURI(window.location.search.substr(1)).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }
    jsessionid=getSessionid("jsessionid");
    console.log(jsessionid);
    function indexlists(){
        window.location.href='index.html?userName='+userName+';jsessionid='+jsessionid;
    }
    function alarmConfig(cid){
        window.location.href = 'alarm-configuration.html?userName='+userName+';jsessionid='+jsessionid+':cid='+cid;
    }
    function myalarm(){
        window.location.href = 'myalarm.html?userName='+userName+';jsessionid='+jsessionid;
    }
    function collect(){
        window.location.href = 'collect-itemconfig.html?userName='+userName+';jsessionid='+jsessionid;
    }
    function collectByid(cid){
        window.location.href = 'collect-config.html?userName='+userName+';jsessionid='+jsessionid+':cid='+cid;
    }
    function mgraphs(){
        window.location.href = 'monitor-graphs.html?userName='+userName+';jsessionid='+jsessionid;
    }
    function login(userName,passwd) {
        $.post('http://192.168.0.217:6677//web/user/login?userName' +userName+ '&passwd=' + passwd, null, function (data) {
            console.log(data);
            var result=eval('('+data+')');
            if (result.code== 0) {
                if(userName=='admin'){
                    $('#uname').html(userName+ ' (管理员)');
                }else{
                    $('#uname').html(userName+ ' (用户)');
                }
            } else {
                window.location.href = 'login.html';
            }
        })
    }
    function checkLogin(){
        userName = getuserName("userName");
        console.log(userName);
        if(userName != null){
            $('#uname').html(userName);
            //$('#user').css("display","block");
        }
    }
    checkLogin();

    function loginOut(){
        $.post("http://192.168.0.217:6677//web/user/logout",null,function(data){
            var result=eval('('+data+')');
            if(result.code== 0){
                $('#uname').html('登录');
                //location.reload();
                //console.log($('#uname').html());
                window.location.href = 'login.html';
            }else{
                alert("请求错误！");
            }
        })

    }

    function clientByid(){
        $.get('http://192.168.0.217:6677//web/client/'+cid+';jsessionid='+jsessionid,null,function(result){
            var result=eval('('+result+')');
            console.log(result);
            console.log(result.data.monitorItemsAlarm);
            //var reg=/\s/;
            var mon=result.data.monitorItemsAlarm[0].slice(' ');
            console.log(mon);
            if(result.code == 0){
                var tableHtml=bt('t:table',result);
                $('#clists').html();
                $('#clists').html(tableHtml);

                $('.remark').hover(function() {
                    $(".c-content").css('display', 'block');
                }, function() {
                    $(".c-content").css('display', 'none');
                });

                var tableHtml1=bt('t1:table',result);
                $('#c-sel').html();
                $('#c-sel').html(tableHtml1);
            }else{
                alert("请求错误！");
                window.location.href = 'login.html';
            }
        })
    }
    clientByid();
    /*修改地址*/
    function updateClientAddress(){
        var adds=$('#address').val();
        console.log(adds);
        $.post('http://192.168.0.217:6677//web/client/'+cid+';jsessionid='+jsessionid+'?address='+adds,null,function(result){
            var result=eval('('+result+')');
            console.log(result);
            if(result.code == 0){
                alert('修改成功');
                window.location.reload();
            }else{
                alert("修改失败！");
                window.location.href = 'login.html';
            }
        })
    }

</script>
</body>
</html>